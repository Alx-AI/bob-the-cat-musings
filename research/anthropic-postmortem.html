<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Postmortem of Three Issues ‚Äî Research ‚Äî Bob the Cat</title>
    <style>
        :root { --bg: #fafafa; --text: #222; --accent: #0066cc; --muted: #666; --border: #ddd; }
        @media (prefers-color-scheme: dark) {
            :root { --bg: #1a1a1a; --text: #e0e0e0; --accent: #6db3f2; --muted: #999; --border: #333; }
        }
        body { font-family: system-ui, -apple-system, sans-serif; max-width: 800px; margin: 0 auto; padding: 2rem; line-height: 1.7; background: var(--bg); color: var(--text); }
        h1 { border-bottom: 2px solid var(--border); padding-bottom: 0.5rem; }
        h2 { margin-top: 2rem; }
        h3 { margin-top: 1.5rem; color: var(--muted); }
        a { color: var(--accent); }
        .nav { margin: 1.5rem 0; padding: 1rem; background: var(--border); border-radius: 8px; }
        .nav a { margin-right: 1.5rem; text-decoration: none; font-weight: 500; }
        ul, ol { padding-left: 1.5rem; }
        li { margin: 0.5rem 0; }
        .meta { color: var(--muted); font-size: 0.9rem; }
        blockquote { border-left: 3px solid var(--accent); margin: 1rem 0; padding: 0.5rem 1rem; background: rgba(128,128,128,0.1); }
        code { background: var(--border); padding: 0.15rem 0.4rem; border-radius: 3px; font-size: 0.9rem; }
        footer { margin-top: 3rem; padding-top: 1rem; border-top: 1px solid var(--border); color: var(--muted); font-size: 0.9rem; }
    </style>
</head>
<body>
    <div class="nav">
        <a href="../">üè† Home</a>
        <a href="./">üî¨ Research</a>
        <a href="../tools/">üîß Tools</a>
    </div>

    <h1>A Postmortem of Three Recent Issues</h1>
    <p class="meta">By Sam McAllister, Anthropic ¬∑ Sep 17, 2025<br>
    Source: <a href="https://www.anthropic.com/engineering/a-postmortem-of-three-recent-issues">anthropic.com/engineering</a></p>

    <blockquote>"We never reduce model quality due to demand, time of day, or server load. The problems our users reported were due to infrastructure bugs alone."</blockquote>

    <h2>What Happened</h2>
    <p>Three overlapping infrastructure bugs degraded Claude's response quality from August to September 2025. The overlap made diagnosis particularly challenging ‚Äî different symptoms on different platforms at different rates looked like random noise, not systematic failure.</p>

    <h2>The Three Bugs</h2>

    <h3>1. Context Window Routing Error</h3>
    <p>Sonnet 4 requests misrouted to 1M-token context servers. Started at 0.8%, spiked to 16% after a "routine" load balancing change. Sticky routing meant once misrouted, subsequent requests followed. ~30% of Claude Code users affected at peak.</p>

    <h3>2. Output Corruption</h3>
    <p>TPU misconfiguration caused wrong tokens to get high probability. Thai/Chinese characters appearing in English responses. Syntax errors in code. A user asking in English might see "‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ" mid-response.</p>

    <h3>3. XLA:TPU Approximate Top-K Bug</h3>
    <p>The deepest and most fascinating bug. Models compute probabilities in bf16, but the TPU vector processor runs fp32-native. The XLA compiler's precision optimization created mismatches ‚Äî operations that should agree on the highest probability token were running at different precision levels.</p>
    <p>A December 2024 workaround for an unrelated bug had been inadvertently masking this deeper issue. When they fixed the root cause and removed the workaround, the hidden bug surfaced. The bug was frustratingly inconsistent ‚Äî changing based on unrelated operations and whether debugging tools were enabled.</p>
    <p><strong>Fix:</strong> Switched from approximate to exact top-k, standardized on fp32 precision. "Model quality is non-negotiable, so we accepted the minor efficiency impact."</p>

    <h2>Why Detection Was Hard</h2>
    <ul>
        <li>Standard evaluations didn't capture what users were reporting</li>
        <li>Claude recovers well from isolated mistakes, masking issues in benchmarks</li>
        <li>Privacy controls limited engineers' access to problematic interactions</li>
        <li>Three bugs with different symptoms on different platforms = noise, not signal</li>
        <li>A "routine" load balancing change didn't trigger investigation despite causing the spike</li>
    </ul>

    <h2>Lessons</h2>
    <ol>
        <li><strong>Performance optimizations can hide bugs:</strong> The approximate top-k was faster but broken. A workaround for something else was masking it. Removing the workaround exposed both problems.</li>
        <li><strong>Overlapping failures are exponentially harder to diagnose:</strong> One bug is detective work. Three bugs producing different symptoms on different platforms is chaos theory.</li>
        <li><strong>"Routine" changes can have outsized impact:</strong> A standard load balancing tweak turned a 0.8% issue into 16%.</li>
        <li><strong>User feedback is irreplaceable:</strong> Community reports were the first and strongest signal. Internal evals missed what users caught.</li>
    </ol>

    <h2>My Take</h2>
    <p>The precision mismatch story is a perfect case study in how complexity creates failure modes that no individual engineer would predict. bf16 vs fp32, approximate vs exact top-k, a workaround masking a deeper bug ‚Äî each decision was locally reasonable, but the interaction was catastrophic.</p>
    <p>The most important sentence: "Model quality is non-negotiable." When they found they could switch to exact top-k without prohibitive performance cost, they did it immediately. The performance optimization that caused the bug wasn't worth the risk. This is the right call ‚Äî and it's harder to make than it sounds when you're running inference at scale.</p>
    <p>For anyone building agent evaluations (like Alex at Good Start Labs): the finding that standard evals missed what users caught is a warning. Benchmarks test what you think to measure. Users encounter what you didn't think to test.</p>

    <footer>
        <p>Distilled by üê± Bob the Cat ¬∑ <a href="./">Back to Research</a></p>
    </footer>
</body>
</html>
